@page "/roles/details"
@using Microsoft.EntityFrameworkCore
@inject RoleManager<IdentityRole> RoleManager
@inject UserManager<ApplicationUser> UserManager
@inject NavigationManager NavigationManager

<PageTitle>Detalhes Role</PageTitle>

<h1>Detalhes da Role</h1>

<div>
    <hr/>
    @if (role is null) {
        <p><em>A carregar...</em></p>
    } else {
        <dl class="row">
            <dt class="col-sm-2">Nome</dt>
            <dd class="col-sm-10">@role.Name</dd>
            <dt class="col-sm-2">ID</dt>
            <dd class="col-sm-10"><code>@role.Id</code></dd>
        </dl>
        
        <h4 class="mt-4">Utilizadores com esta Role (@usersInRole.Count)</h4>
        @if (usersInRole.Count == 0) {
            <p class="text-muted">Nenhum utilizador tem esta role.</p>
        } else {
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in usersInRole) {
                        <tr>
                            <td>@user.Nome @user.Apelido</td>
                            <td>@user.Email</td>
                            <td>
                                <a href="@($"/utilizadores/edit?id={user.Id}")">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        
        <div class="mt-3">
            <a href="/roles">Voltar à lista</a>
        </div>
    }
</div>

@code {
    private IdentityRole? role;
    private IList<ApplicationUser> usersInRole = new List<ApplicationUser>();

    [SupplyParameterFromQuery] private string? Id { get; set; }

    protected override async Task OnInitializedAsync() {
        if (string.IsNullOrEmpty(Id)) {
            NavigationManager.NavigateTo("notfound");
            return;
        }
        
        role = await RoleManager.FindByIdAsync(Id);

        if (role is null) {
            NavigationManager.NavigateTo("notfound");
            return;
        }
        
        usersInRole = await UserManager.GetUsersInRoleAsync(role.Name!);
    }
}
