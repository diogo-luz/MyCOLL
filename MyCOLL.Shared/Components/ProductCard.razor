@using MyCOLL.Shared.DTOs

<div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-4">
    <div class="card h-100 shadow-sm border-0 product-card-hover">
        <div class="position-relative">
            <!-- Image / Placeholder -->
            <div class="ratio ratio-1x1 bg-light d-flex align-items-center justify-content-center overflow-hidden rounded-top">
                @if (Produto.Imagem != null) {
                    <img src="data:image/png;base64,@Convert.ToBase64String(Produto.Imagem)"
                         alt="@Produto.Nome" class="w-100 h-100 object-fit-cover"/>
                } else if (!string.IsNullOrEmpty(Produto.UrlImagem)) {
                    <img src="@Produto.UrlImagem" alt="@Produto.Nome" class="w-100 h-100 object-fit-cover"/>
                } else {
                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                }
            </div>

            <!-- Badge / Favorite -->
            <button class="btn btn-light rounded-circle shadow-sm position-absolute top-0 end-0 m-2 p-2"
                    title="Adicionar aos favoritos">
                <i class="bi bi-heart text-danger"></i>
            </button>

            @if (!string.IsNullOrEmpty(Produto.CategoriaNome)) {
                <span class="badge bg-primary position-absolute top-0 start-0 m-2 shadow-sm">
                    @Produto.CategoriaNome
                </span>
            }
        </div>

        <div class="card-body d-flex flex-column">
            <h5 class="card-title text-truncate fw-bold mb-1" title="@Produto.Nome">
                @Produto.Nome
            </h5>

            <div class="mt-auto pt-3 d-flex justify-content-between align-items-center">
                <span class="h5 mb-0 text-primary fw-bold">@Produto.PrecoFinal.ToString("C")</span>
            </div>
        </div>

        <div class="card-footer bg-white border-0 pt-0 pb-3">
            <div class="d-grid gap-2">
                <button class="btn btn-outline-primary" @onclick="() => OnViewDetails.InvokeAsync(Produto.Id)">
                    Ver Detalhes
                </button>
                <button class="btn btn-primary" @onclick="AddToCart" disabled="@(Produto.Stock <= 0)">
                    <i class="bi bi-cart-plus me-1"></i>
                    @if (Produto.Stock > 0) {
                        <span>Adicionar</span>
                    } else {
                        <span>Esgotado</span>
                    }
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public ProdutoDTO Produto { get; set; } = new();
    [Parameter] public EventCallback<int> OnViewDetails { get; set; }
    [Parameter] public EventCallback<ProdutoDTO> OnAddToCart { get; set; }

    private async Task AddToCart() {
        if (Produto.Stock > 0) {
            await OnAddToCart.InvokeAsync(Produto);
        }
    }

}
