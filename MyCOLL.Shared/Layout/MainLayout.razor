@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@inject IAuthService AuthService
@inject ICarrinhoService CarrinhoService
@inject NavigationManager Nav

<div class="layout-container">
    @* Header *@
    <header class="main-header">
        <div class="header-content">
            <a href="/" class="logo">
                <i class="bi bi-palette2 logo-icon"></i>
                <span class="logo-text">MyCOLL</span>
            </a>

            <nav class="nav-links">
                <a href="/carrinho" class="nav-link">
                    <i class="bi bi-cart3 nav-icon"></i>
                    <span>Carrinho</span>
                    @if (_cartCount > 0) {
                        <span class="cart-badge">@_cartCount</span>
                    }
                </a>

                <AuthorizeView>
                    <Authorized>
                        <AuthorizeView Roles="Fornecedor" Context="supplierContext">
                            <a href="/fornecedor/dashboard" class="nav-link">
                                <i class="bi bi-speedometer2 nav-icon"></i>
                                <span>Painel</span>
                            </a>
                            <a href="/fornecedor/produtos" class="nav-link">
                                <i class="bi bi-box-seam nav-icon"></i>
                                <span>Produtos</span>
                            </a>
                        </AuthorizeView>
                        <a href="/minhas-encomendas" class="nav-link">
                            <i class="bi bi-box2-heart nav-icon"></i>
                            <span>Encomendas</span>
                        </a>
                        <a href="/perfil" class="nav-link">
                            <i class="bi bi-person-circle nav-icon"></i>
                            <span>Perfil</span>
                        </a>
                        <button class="nav-link logout-btn" @onclick="Logout">
                            <i class="bi bi-box-arrow-right nav-icon"></i>
                            <span>Sair</span>
                        </button>
                    </Authorized>
                    <NotAuthorized>
                        <a href="/login" class="nav-link">
                            <i class="bi bi-box-arrow-in-right nav-icon"></i>
                            <span>Login</span>
                        </a>
                        <a href="/registar" class="nav-link btn-register">
                            <i class="bi bi-person-plus nav-icon"></i>
                            <span>Registar</span>
                        </a>
                    </NotAuthorized>
                </AuthorizeView>
            </nav>
        </div>
    </header>

    @* Main Content *@
    <main class="main-content">
        @Body
    </main>

    @* Footer *@
    <footer class="main-footer">
        <p>© @DateTime.Now.Year MyCOLL - Colecionáveis</p>
    </footer>
</div>

@code {
    private int _cartCount = 0;

    protected override async Task OnInitializedAsync() {
        _cartCount = await CarrinhoService.GetItemCountAsync();
    }

    private async Task Logout() {
        await AuthService.LogoutAsync();
        Nav.NavigateTo("/", forceLoad: true);
    }

}
