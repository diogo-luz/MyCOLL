@page "/login"
@inject IAuthService AuthService
@inject NavigationManager Nav

<PageTitle>Login - MyCOLL</PageTitle>

<div class="auth-container">
    <div class="auth-card">
        <h1 class="auth-title">ðŸ”‘ Login</h1>
        
        @if (!string.IsNullOrEmpty(_error)) {
            <div class="error-message">@_error</div>
        }

        <EditForm Model="_loginModel" OnValidSubmit="HandleLogin">
            <DataAnnotationsValidator />

            <div class="form-group">
                <label>Email</label>
                <InputText @bind-Value="_loginModel.Email" class="form-input" placeholder="seu@email.com" />
                <ValidationMessage For="() => _loginModel.Email" />
            </div>

            <div class="form-group">
                <label>Password</label>
                <InputText @bind-Value="_loginModel.Password" type="password" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                <ValidationMessage For="() => _loginModel.Password" />
            </div>

            <button type="submit" class="btn-submit" disabled="@_loading">
                @if (_loading) {
                    <span>A entrar...</span>
                } else {
                    <span>Entrar</span>
                }
            </button>
        </EditForm>

        <div class="auth-footer">
            <p>NÃ£o tem conta? <a href="/registar">Registar</a></p>
        </div>
    </div>
</div>

@code {
    private LoginDTO _loginModel = new();
    private string? _error;
    private bool _loading;

    private async Task HandleLogin() {
        _loading = true;
        _error = null;

        var result = await AuthService.LoginAsync(_loginModel.Email, _loginModel.Password);

        if (result.Success) {
            Nav.NavigateTo("/", forceLoad: true);
        } else {
            _error = result.Error ?? "Erro ao fazer login";
        }

        _loading = false;
    }
}
